import os
import telebot
from openai import OpenAI

telegram_token = os.getenv("TELEGRAM_BOT_TOKEN")
openai_token = os.getenv("OPENAI_API_KEY")

bot = telebot.TeleBot(telegram_token)
client = OpenAI(api_key=openai_token)

@bot.message_handler(func=lambda m: True)
def reply(message):
    try:
        # Çagyryşda dogry metod: ChatCompletion.create
        response = client.ChatCompletion.create(
            model="gpt-4.1-mini",  # Modeli dogry görkezmek
            messages=[{"role": "user", "content": message.text}]
        )

        answer = response['choices'][0]['message']['content']  # Dogry çykan maglumat
        bot.reply_to(message, answer)

    except Exception as e:
        bot.reply_to(message, "Ýalňyşlyk ýüze çykdy!")
        print(e)

bot.polling(non_stop=True)
